CREATE OR ALTER VIEW VIEW_ROMANEIO(
    CODIGO,
    DATA,
    FILIAL,
    NOMEFILIAL,
    TRANSPORTADOR,
    NOMETRANSPORTADOR,
    VEICULO,
    PLACA,
    IMPORTADO,
    FATURADO,
    VALORADIANTAMENTO,
    FECHADO,
    CONFERIDO,
    ENTREGA,
    OBS,
    LOCALEMBARQUE,
    NOMELOCALEMBARQUE,
    DATAFECHAMENTO,
    HORAFECHAMENTO,
    FUNCIONARIOFECHAMENTO,
    NOMEFUNCIONARIOFECHAMENTO,
    RATEIO,
    MOTORISTA,
    NOMEMOTORISTA,
    AUXILIAR,
    NOMEAUXILIAR,
    KMSAIDA,
    KMRETORNO,
    DATASAIDA,
    DATARETORNO,
    HORASAIDA,
    HORARETORNO,
    KMPERCORRIDO)
AS
SELECT ROMANEIO.CODIGO, ROMANEIO.DATA
, ROMANEIO.FILIAL, FILIAL.NOME
, ROMANEIO.TRANSPORTADOR, TRANSPORTADOR.NOME
, ROMANEIO.VEICULO, VEICULO.PLACA
, ROMANEIO.IMPORTADO, ROMANEIO.FATURADO, ROMANEIO.VALORADIANTAMENTO
, ROMANEIO.FECHADO, ROMANEIO.CONFERIDO, ROMANEIO.ENTREGA, ROMANEIO.OBS
, ROMANEIO.LOCALEMBARQUE, LOCALEMBARQUE.NOME
, ROMANEIO.DATAFECHAMENTO, ROMANEIO.HORAFECHAMENTO
, ROMANEIO.FUNCIONARIOFECHAMENTO, FUNCIONARIO.NOME
, ROMANEIO.RATEIO
, ROMANEIO.MOTORISTA
, MOTORISTA.NOME
, ROMANEIO.AUXILIAR
, AUXILIAR.NOME
, ROMANEIO.KMSAIDA
, ROMANEIO.KMRETORNO
, ROMANEIO.DATASAIDA
, ROMANEIO.DATARETORNO
, ROMANEIO.HORASAIDA
, ROMANEIO.HORARETORNO
, CASE WHEN ((ROMANEIO.KMSAIDA > 0) AND (ROMANEIO.KMRETORNO > 0)) THEN (ROMANEIO.KMRETORNO - ROMANEIO.KMSAIDA) ELSE 0 END AS KMPERCORRIDO
FROM ROMANEIO
INNER JOIN FILIAL ON FILIAL.CODIGO = ROMANEIO.FILIAL
LEFT JOIN TRANSPORTADOR ON TRANSPORTADOR.CODIGO = ROMANEIO.TRANSPORTADOR
LEFT JOIN VEICULO ON VEICULO.CODIGO = ROMANEIO.VEICULO
LEFT JOIN LOCALEMBARQUE ON LOCALEMBARQUE.CODIGO = ROMANEIO.LOCALEMBARQUE
LEFT JOIN FUNCIONARIO ON FUNCIONARIO.CODIGO = ROMANEIO.FUNCIONARIOFECHAMENTO
LEFT JOIN FUNCIONARIO MOTORISTA ON MOTORISTA.CODIGO = ROMANEIO.MOTORISTA
LEFT JOIN FUNCIONARIO AUXILIAR ON AUXILIAR.CODIGO = ROMANEIO.AUXILIAR
;

