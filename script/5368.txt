--LISTA ABERTOS
SELECT
    'ABERTO' AS STATUS,
    LIST(ROMANEIO.CODIGO, ', ')
FROM ROMANEIO
WHERE ROMANEIO.DATA BETWEEN :DATAINICIO AND :DATAFIM
AND ROMANEIO.FILIAL = :FILIAL
AND ROMANEIO.FECHADO = 'N'
GROUP BY 1

--LISTA FECHADOS
SELECT
    'FECHADO' AS STATUS,
    LIST(ROMANEIO.CODIGO, ', ')
FROM ROMANEIO
WHERE ROMANEIO.DATAFECHAMENTO BETWEEN :DATAINICIO AND :DATAFIM
AND ROMANEIO.FILIAL = :FILIAL
AND ROMANEIO.FECHADO = 'S'
GROUP BY 1

--TOTAL FATURADO
SELECT
CASE WHEN(ITEMROMANEIO.TIPO = 'P') THEN PEDIDO.FORMAPAGAMENTO ELSE NF.FORMAPAGAMENTO END AS FORMAPAGAMENTO
,FORMAPAGAMENTO.NOME AS NOMEFORMAPAGAMENTO
,SUM( CASE WHEN(ITEMROMANEIO.TIPO = 'P') THEN PEDIDO.TOTAL ELSE CASE WHEN NFP.TOTAL IS NOT NULL THEN NFP.TOTAL ELSE NF.TOTAL END END) AS TOTAL
FROM ROMANEIO
INNER JOIN ITEMROMANEIO ON ITEMROMANEIO.ROMANEIO = ROMANEIO.CODIGO
LEFT JOIN PEDIDO ON ITEMROMANEIO.TIPO = 'P' AND PEDIDO.NUMERO = ITEMROMANEIO.NUMERO AND PEDIDO.FILIAL = ROMANEIO.FILIAL
LEFT JOIN NF ON ITEMROMANEIO.TIPO = 'N' AND NF.NUMERO = ITEMROMANEIO.NUMERO AND NF.SERIE = ITEMROMANEIO.SERIE AND NF.FILIAL = ROMANEIO.FILIAL AND NF.ORIGEM = 'P'
LEFT JOIN NF NFP ON ITEMROMANEIO.TIPO = 'P' AND NFP.PEDIDO = ITEMROMANEIO.NUMERO AND NFP.FILIAL = ROMANEIO.FILIAL AND NFP.ORIGEM = 'P' AND NFP.CLIFOR = PEDIDO.CLIFOR AND NFP.CANCELADA = 'N'
LEFT JOIN TIPOCFOP ON ((ITEMROMANEIO.TIPO = 'P' AND TIPOCFOP.CODIGO = NFP.TIPOCFOP) OR (ITEMROMANEIO.TIPO = 'N' AND TIPOCFOP.CODIGO = NF.TIPOCFOP))
LEFT JOIN FORMAPAGAMENTO ON FORMAPAGAMENTO.CODIGO = CASE WHEN(ITEMROMANEIO.TIPO = 'P') THEN PEDIDO.FORMAPAGAMENTO ELSE NF.FORMAPAGAMENTO END
WHERE ((TIPOCFOP.FATURA = 'S') OR (TIPOCFOP.FATURA IS NULL))
AND ROMANEIO.DATA BETWEEN '15.01.2019' AND '12.04.2019'
AND ROMANEIO.CODIGO = 66406
AND ROMANEIO.FECHADO = 'S'
GROUP BY 1,2

--TOTAL RECEBIDO
SELECT FINANCEIRO.FORMAPAGAMENTO, FORMAPAGAMENTO.NOME,  SUM(CAIXA.VALOR) FROM CAIXA
INNER JOIN FINANCEIRO ON FINANCEIRO.CAIXA = CAIXA.CODIGO
LEFT JOIN FORMAPAGAMENTO ON FINANCEIRO.FORMAPAGAMENTO = FORMAPAGAMENTO.CODIGO
WHERE CAIXA.ROMANEIO = 66850 AND DATA > '01.01.2019'
GROUP BY 1,2


           		   